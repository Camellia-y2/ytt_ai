<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>document</title>
  </head>
  <body>
    <div id="root"></div>
    <script>
      function getJSONP({url, params = {}, callback}) {
        //DOM
        // .then返回一个promise
        return new Promise((resolve, reject) => {
          let script = document.createElement('script');
          params = { ...params, callback }
          console.log(params) // {wd: 'I love you', callback: 'show'}
          // queryString查询字符串的对象 ?callback=show&a=1&b=2
          let arr = [];
          for(let key in params) {
            arr.push(`${key}=${params[key]}`)
          }
          console.log(arr); //  ['wd=I love you', 'callback=show']
          // queryString 以?开始
          script.src = `${url}?${arr.join('&')}`

          // callback 是一个变量
          // 在全局作用域（即 window 对象）中创建一个名为 callback 值的新函数。
          // 例如，如果 callback 的值是 'show'，那么这行代码实际上是在创建一个名为 show 的新函数。
          window[callback] = function(data) {
            resolve(data);
          }
          document.body.append(script);
        })
      }
     getJSONP({
        url: 'http://localhost:3000/say',
        params: { // 查询参数
          wd: 'I love you'
        },
        callback:'show' // 必须的
      }).then(data => {
        console.log(data)
      })
    </script>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
